"use client";

import React, { useEffect, useRef, useState } from "react";
import "../component.css";
import Button from "./Button";
import { useNotification } from "../../components/ui/NotificationProvider.jsx";

const VideoCall = ({
	userData,
	isVideo,
	isVoice,
	setIsVideo,
	setIsVoice,
	localStream,
	remoteStream,
	handleCallUser,
}) => {
	// console.log({ userData });
	const [localUserData, setLocalUserData] = useState(userData.userData);
	const localVideoRef = useRef(null);
	const remoteVideoRef = useRef(null);

	useEffect(() => {
		if (localVideoRef.current) {
			remoteVideoRef.current.srcObject = remoteStream;
		}
	}, [remoteStream]);
	useEffect(() => {
		if (localVideoRef.current) {
			localVideoRef.current.srcObject = localStream;
		}
	}, [localStream]);

	useEffect(() => {
		// Access the video element here
		// if (localVideoRef.current) {
		// 	localVideoRef.current.srcObject = localStream;
		// }
	}, []);

	const { alertMessage } = useNotification();

	const handleVideo = () => {
		setIsVideo((prev) => !prev);
	};
	const handleVoice = () => {
		setIsVoice((prev) => !prev);
	};

	return (
		<div className="vs-call-wrapper">
			<Button onClick={handleCallUser}>Call</Button>
			<div className="vs-call-video-wrapper">
				<div className="vs-call-recepient-body">
					<video ref={remoteVideoRef} autoPlay playsInline />
					<svg
						width="16"
						height="16"
						viewBox="0 0 16 16"
						fill="none"
						xmlns="http://www.w3.org/2000/svg">
						<path
							d="M4.14645 0.146447C4.24021 0.0526784 4.36739 0 4.5 0H11.5C11.7761 0 12 0.223858 12 0.5C12 1.17938 11.6581 1.67405 11.3536 1.97855C11.2281 2.10398 11.1036 2.20305 11 2.27658V6.70807C11.0246 6.72292 11.0505 6.7388 11.0775 6.75569C11.2807 6.88271 11.5538 7.0702 11.8293 7.31121C12.3591 7.77485 13 8.52678 13 9.5C13 9.77614 12.7761 10 12.5 10H8.5V14.5C8.5 14.7761 8.27614 16 8 16C7.72386 16 7.5 14.7761 7.5 14.5V10H3.5C3.22386 10 3 9.77614 3 9.5C3 8.52678 3.64087 7.77485 4.17075 7.31121C4.44619 7.0702 4.71927 6.88271 4.9225 6.75569C4.94953 6.7388 4.97541 6.72292 5 6.70807V2.27658C4.89642 2.20305 4.77188 2.10398 4.64645 1.97855C4.34195 1.67405 4 1.17938 4 0.5C4 0.367392 4.05268 0.240215 4.14645 0.146447ZM5.72613 1.55405L5.72395 1.55296L5.72613 1.55405ZM5.72395 1.55296L5.72613 1.55405C5.89405 1.63921 6 1.81156 6 2V7C6 7.18922 5.89319 7.36221 5.72405 7.44699L5.72217 7.44795L5.70996 7.4543C5.69838 7.46037 5.68016 7.4701 5.65622 7.48335C5.60829 7.50988 5.53786 7.55033 5.4525 7.60369C5.28073 7.71104 5.05381 7.8673 4.82925 8.06379C4.51113 8.34215 4.24383 8.66021 4.10424 9H11.8958C11.7562 8.66021 11.4889 8.34215 11.1707 8.06379C10.9462 7.8673 10.7193 7.71104 10.5475 7.60369C10.4621 7.55033 10.3917 7.50988 10.3438 7.48335C10.3198 7.4701 10.3016 7.46037 10.29 7.4543L10.2778 7.44795L10.2764 7.44721C10.1071 7.36247 10 7.1893 10 7V2C10 1.81086 10.1067 1.63793 10.2757 1.55311C10.279 1.55137 10.2857 1.54771 10.2949 1.54244C10.3134 1.53186 10.3426 1.51442 10.3789 1.49022C10.4523 1.44128 10.5501 1.36784 10.6464 1.27145C10.7267 1.19118 10.8007 1.10082 10.86 1H5.14003C5.19933 1.10082 5.27328 1.19118 5.35355 1.27145C5.44995 1.36784 5.54768 1.44128 5.6211 1.49022C5.65739 1.51442 5.68658 1.53186 5.7051 1.54244C5.71433 1.54771 5.72068 1.55122 5.72395 1.55296Z"
							fill="white"
						/>
					</svg>
					{/* <video type="video/mp4" height="100%" width="100%" autoplay>
						<source src="pexels-cottonbro-5486225 (2160p).mp4" />
					</video> */}
					{/* <div class="vs-call-recepient-picture">
                    
                </div>  */}
				</div>
				<div className="vs-call-caller-body">
					{isVideo ? (
						<video ref={localVideoRef} autoPlay playsInline muted />
					) : (
						<div className="vs-call-caller-picture">
							<img
								src={`https://api.dicebear.com/7.x/pixel-art/svg?seed=${userData.uid}`}
								alt=""
							/>
						</div>
					)}
					<svg
						width="16"
						height="16"
						viewBox="0 0 16 16"
						fill="none"
						xmlns="http://www.w3.org/2000/svg">
						<path
							d="M4.14645 0.146447C4.24021 0.0526784 4.36739 0 4.5 0H11.5C11.7761 0 12 0.223858 12 0.5C12 1.17938 11.6581 1.67405 11.3536 1.97855C11.2281 2.10398 11.1036 2.20305 11 2.27658V6.70807C11.0246 6.72292 11.0505 6.7388 11.0775 6.75569C11.2807 6.88271 11.5538 7.0702 11.8293 7.31121C12.3591 7.77485 13 8.52678 13 9.5C13 9.77614 12.7761 10 12.5 10H8.5V14.5C8.5 14.7761 8.27614 16 8 16C7.72386 16 7.5 14.7761 7.5 14.5V10H3.5C3.22386 10 3 9.77614 3 9.5C3 8.52678 3.64087 7.77485 4.17075 7.31121C4.44619 7.0702 4.71927 6.88271 4.9225 6.75569C4.94953 6.7388 4.97541 6.72292 5 6.70807V2.27658C4.89642 2.20305 4.77188 2.10398 4.64645 1.97855C4.34195 1.67405 4 1.17938 4 0.5C4 0.367392 4.05268 0.240215 4.14645 0.146447ZM5.72613 1.55405L5.72395 1.55296L5.72613 1.55405ZM5.72395 1.55296L5.72613 1.55405C5.89405 1.63921 6 1.81156 6 2V7C6 7.18922 5.89319 7.36221 5.72405 7.44699L5.72217 7.44795L5.70996 7.4543C5.69838 7.46037 5.68016 7.4701 5.65622 7.48335C5.60829 7.50988 5.53786 7.55033 5.4525 7.60369C5.28073 7.71104 5.05381 7.8673 4.82925 8.06379C4.51113 8.34215 4.24383 8.66021 4.10424 9H11.8958C11.7562 8.66021 11.4889 8.34215 11.1707 8.06379C10.9462 7.8673 10.7193 7.71104 10.5475 7.60369C10.4621 7.55033 10.3917 7.50988 10.3438 7.48335C10.3198 7.4701 10.3016 7.46037 10.29 7.4543L10.2778 7.44795L10.2764 7.44721C10.1071 7.36247 10 7.1893 10 7V2C10 1.81086 10.1067 1.63793 10.2757 1.55311C10.279 1.55137 10.2857 1.54771 10.2949 1.54244C10.3134 1.53186 10.3426 1.51442 10.3789 1.49022C10.4523 1.44128 10.5501 1.36784 10.6464 1.27145C10.7267 1.19118 10.8007 1.10082 10.86 1H5.14003C5.19933 1.10082 5.27328 1.19118 5.35355 1.27145C5.44995 1.36784 5.54768 1.44128 5.6211 1.49022C5.65739 1.51442 5.68658 1.53186 5.7051 1.54244C5.71433 1.54771 5.72068 1.55122 5.72395 1.55296Z"
							fill="white"
						/>
					</svg>
				</div>
			</div>
			<div className="vs-call-menu">
				<div className="vs-call-caller-setting-button">
					<button className="vs-call-caller-setting-button">
						<svg
							width="38"
							height="38"
							viewBox="0 0 38 38"
							fill="none"
							xmlns="http://www.w3.org/2000/svg">
							<path
								d="M19 15.4851C18.3047 15.4851 17.625 15.6913 17.0468 16.0776C16.4687 16.4639 16.0181 17.0129 15.752 17.6553C15.4859 18.2977 15.4163 19.0046 15.5519 19.6866C15.6876 20.3685 16.0224 20.995 16.5141 21.4866C17.0057 21.9783 17.6322 22.3131 18.3141 22.4488C18.9961 22.5844 19.703 22.5148 20.3454 22.2487C20.9878 21.9826 21.5368 21.532 21.9231 20.9539C22.3094 20.3757 22.5156 19.696 22.5156 19.0007C22.5156 18.0683 22.1452 17.1741 21.4859 16.5148C20.8266 15.8555 19.9324 15.4851 19 15.4851ZM30.7188 15.4851C30.0206 15.4711 29.3341 15.6654 28.7468 16.0431C28.1595 16.4208 27.6979 16.9649 27.421 17.6059C27.1441 18.2469 27.0644 18.9559 27.192 19.6424C27.3196 20.329 27.6488 20.962 28.1375 21.4607C28.6263 21.9594 29.2525 22.3013 29.9363 22.4427C30.6201 22.5842 31.3306 22.5188 31.9771 22.2549C32.6236 21.991 33.1768 21.5406 33.5663 20.961C33.9558 20.3814 34.1639 19.699 34.1641 19.0007C34.1642 18.0804 33.8035 17.1966 33.1593 16.5393C32.5152 15.882 31.6389 15.5035 30.7188 15.4851ZM7.28125 15.4851C6.58909 15.4989 5.91642 15.7168 5.3476 16.1114C4.77878 16.5061 4.33914 17.0598 4.0838 17.7033C3.82846 18.3468 3.76879 19.0514 3.91228 19.7287C4.05577 20.4059 4.39602 21.0258 4.89038 21.5104C5.38473 21.9951 6.01117 22.323 6.69115 22.453C7.37113 22.5831 8.07436 22.5095 8.71267 22.2415C9.35098 21.9734 9.89595 21.5229 10.2792 20.9464C10.6625 20.3699 10.8671 19.693 10.8672 19.0007C10.8673 18.533 10.7741 18.0701 10.593 17.6389C10.412 17.2077 10.1467 16.817 9.81275 16.4896C9.47881 16.1622 9.08291 15.9047 8.64823 15.7322C8.21354 15.5598 7.74881 15.4757 7.28125 15.4851Z"
								fill="white"
							/>
						</svg>
					</button>
				</div>
				<div className="vs-call-caller-mic-button">
					<button
						className="vs-call-caller-mic-button"
						onClick={handleVoice}>
						<svg
							width="34"
							height="34"
							viewBox="0 0 34 34"
							fill="none"
							xmlns="http://www.w3.org/2000/svg">
							<path
								d="M17.0034 18.3203C18.7931 18.3203 20.2334 16.8965 20.2334 15.1562V7.77344C20.2334 6.0332 18.7931 4.60938 17.0034 4.60938C15.2137 4.60938 13.7734 6.0332 13.7734 7.77344V15.1562C13.7734 16.8965 15.2137 18.3203 17.0034 18.3203Z"
								fill="white"
								fillOpacity="0.15"
							/>
							<path
								d="M27.8779 15.0918C27.8779 14.9468 27.7593 14.8281 27.6143 14.8281H25.6367C25.4917 14.8281 25.373 14.9468 25.373 15.0918C25.373 19.7159 21.6256 23.4634 17.0015 23.4634C12.3773 23.4634 8.62988 19.7159 8.62988 15.0918C8.62988 14.9468 8.51123 14.8281 8.36621 14.8281H6.38867C6.24365 14.8281 6.125 14.9468 6.125 15.0918C6.125 20.652 10.2976 25.2399 15.6831 25.8892V29.2642H10.8942C10.4426 29.2642 10.0801 29.7355 10.0801 30.3188V31.5054C10.0801 31.6504 10.1724 31.769 10.2844 31.769H23.7185C23.8306 31.769 23.9229 31.6504 23.9229 31.5054V30.3188C23.9229 29.7355 23.5603 29.2642 23.1088 29.2642H18.188V25.9056C23.6361 25.3124 27.8779 20.6981 27.8779 15.0918Z"
								fill="white"
							/>
							<path
								d="M17.0015 20.6914C20.0963 20.6914 22.6045 18.2129 22.6045 15.1543V7.77148C22.6045 4.71289 20.0963 2.23438 17.0015 2.23438C13.9066 2.23438 11.3984 4.71289 11.3984 7.77148V15.1543C11.3984 18.2129 13.9066 20.6914 17.0015 20.6914ZM13.7715 7.77148C13.7715 6.03125 15.2118 4.60742 17.0015 4.60742C18.7911 4.60742 20.2314 6.03125 20.2314 7.77148V15.1543C20.2314 16.8945 18.7911 18.3184 17.0015 18.3184C15.2118 18.3184 13.7715 16.8945 13.7715 15.1543V7.77148Z"
								fill="white"
							/>
						</svg>
					</button>
				</div>
				<div className="vs-call-caller-video-button">
					<button
						className="vs-call-caller-video-button"
						onClick={handleVideo}>
						<svg
							width="35"
							height="23"
							viewBox="0 0 35 23"
							fill="none"
							xmlns="http://www.w3.org/2000/svg">
							<path
								fillRule="evenodd"
								clipRule="evenodd"
								d="M6.62891 3.92188H18.5527C19.4152 3.92188 20.2424 4.26264 20.8522 4.8692C21.4621 5.47576 21.8047 6.29844 21.8047 7.15625V15.7812C21.8047 16.6391 21.4621 17.4617 20.8522 18.0683C20.2424 18.6749 19.4152 19.0156 18.5527 19.0156H6.62891C5.76643 19.0156 4.93929 18.6749 4.32943 18.0683C3.71957 17.4617 3.37695 16.6391 3.37695 15.7812V7.15625C3.37695 6.29844 3.71957 5.47576 4.32943 4.8692C4.93929 4.26264 5.76643 3.92188 6.62891 3.92188ZM24.9526 16.9392C24.6799 18.4296 23.89 19.7777 22.7204 20.7482C21.5509 21.7187 20.0759 22.2502 18.5527 22.25H6.62891C4.90396 22.25 3.24967 21.5685 2.02995 20.3553C0.810231 19.1422 0.125 17.4969 0.125 15.7812L0.125 7.15625C0.125 5.44063 0.810231 3.79528 2.02995 2.58215C3.24967 1.36903 4.90396 0.6875 6.62891 0.6875H18.5527C20.0759 0.687271 21.5509 1.21876 22.7204 2.1893C23.89 3.15984 24.6799 4.50787 24.9526 5.99834L28.3216 3.60491C28.9351 3.1686 29.6577 2.9089 30.4099 2.85432C31.1622 2.79974 31.915 2.9524 32.5857 3.29552C33.2564 3.63864 33.8191 4.15896 34.2119 4.79934C34.6047 5.43971 34.8125 6.17537 34.8125 6.92553V16.012C34.8125 16.7621 34.6047 17.4978 34.2119 18.1382C33.8191 18.7785 33.2564 19.2989 32.5857 19.642C31.915 19.9851 31.1622 20.1378 30.4099 20.0832C29.6577 20.0286 28.9351 19.7689 28.3216 19.3326L24.9526 16.9392ZM25.0566 13.0385L30.2121 16.702C30.3395 16.7928 30.4897 16.847 30.646 16.8584C30.8024 16.8699 30.9589 16.8382 31.0983 16.7668C31.2377 16.6955 31.3547 16.5873 31.4362 16.4541C31.5178 16.3209 31.5608 16.1679 31.5605 16.012V6.92553C31.5608 6.76959 31.5178 6.6166 31.4362 6.48342C31.3547 6.35024 31.2377 6.24202 31.0983 6.17068C30.9589 6.09934 30.8024 6.06764 30.646 6.07909C30.4897 6.09053 30.3395 6.14466 30.2121 6.23553L25.0566 9.899V13.0385Z"
								fill="white"
							/>
						</svg>
					</button>
				</div>
				<div className="vs-call-caller-callend-button">
					<button className="vs-call-caller-callend-button">
						<svg
							width="64"
							height="64"
							viewBox="0 0 64 64"
							fill="none"
							xmlns="http://www.w3.org/2000/svg">
							<g clipPath="url(#clip0_809_261)">
								<path
									d="M52.0791 28.3447C40.7934 17.059 22.4957 17.059 11.21 28.3447C10.7008 28.8539 10.2146 29.3773 9.75133 29.9138C9.21977 30.5295 8.95398 30.8372 8.84311 31.2487C8.75135 31.5893 8.76704 32.015 8.88345 32.3482C9.02386 32.7504 9.3404 33.067 9.97334 33.6999L13.6876 37.4141C14.2199 37.9465 14.4861 38.2126 14.8018 38.3531C15.0807 38.4774 15.3859 38.531 15.6904 38.5097C16.0352 38.4855 16.3763 38.3263 17.0585 38.008L22.8235 35.3177C23.6172 34.9472 24.0141 34.762 24.2723 34.468C24.4999 34.2087 24.651 33.8912 24.709 33.5511C24.7748 33.1654 24.6686 32.7407 24.456 31.8908L23.7344 29.0039C28.8101 27.0925 34.4779 27.0962 39.5547 29.0039L38.833 31.8909C38.6205 32.7406 38.5143 33.1654 38.5801 33.5511C38.6381 33.8912 38.7892 34.2087 39.0168 34.468C39.275 34.762 39.6719 34.9472 40.4655 35.3176L46.2306 38.008C46.9128 38.3263 47.2539 38.4855 47.5986 38.5097C47.9032 38.5311 48.2083 38.4773 48.4873 38.3531C48.803 38.2126 49.0692 37.9464 49.6015 37.4141L53.3157 33.6999C53.9487 33.0669 54.2652 32.7504 54.4057 32.3482C54.5221 32.0151 54.5376 31.5894 54.4459 31.2486C54.3351 30.8372 54.0693 30.5294 53.5377 29.9138C53.0745 29.3774 52.5883 28.8539 52.0791 28.3447Z"
									stroke="white"
									strokeWidth="5"
									strokeLinecap="round"
									strokeLinejoin="round"
								/>
							</g>
							<defs>
								<clipPath id="clip0_809_261">
									<rect
										width="44.7466"
										height="44.7466"
										fill="white"
										transform="translate(63.2812 31.6406) rotate(135)"
									/>
								</clipPath>
							</defs>
						</svg>
					</button>
				</div>
			</div>
		</div>
	);
};

export default VideoCall;
